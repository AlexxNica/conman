##
# ConMan Makefile
#   by Chris Dunlap <cdunlap@llnl.gov>
#
# $Id: Makefile.in,v 1.7 2001/08/17 22:17:59 dun Exp $
##

PACKAGE=	@PACKAGE@
VERSION=	@VERSION@

CC=		@CC@
DEFS=		@DEFS@
CFLAGS=		@CFLAGS@
LDFLAGS=	@LDFLAGS@
LIBS=		@LIBS@
RANLIB=		@RANLIB@
INSTALL=	@INSTALL@
@SET_MAKE@
COPTS=		$(CFLAGS) $(CPPFLAGS) $(DEFS)

AC_OUTPUT=	Makefile config.h conman.spec

prefix=		@prefix@
exec_prefix=	@exec_prefix@
bindir=		@bindir@
sbindir=	@sbindir@
libdir=		@libdir@

PROGS=		conman conmand
COMMON_OBJS=	common.o errors.o list.o lex.o util.o @LIBOBJS@
CLIENT_OBJS=	client.o client-conf.o client-sock.o client-tty.o $(COMMON_OBJS)
SERVER_OBJS1=	server.o server-conf.o server-esc.o server-obj.o server-sock.o
SERVER_OBJS=	$(SERVER_OBJS1) $(COMMON_OBJS)
COMMON_LIBS=	$(LIBS)
CLIENT_LIBS=	$(COMMON_LIBS)
SERVER_LIBS=	-lpthread $(COMMON_LIBS)


all: $(PROGS)

conman: $(CLIENT_OBJS)
	$(CC) $(COPTS) $(LDFLAGS) $(CLIENT_OBJS) -o $@ $(CLIENT_LIBS)

conmand: $(SERVER_OBJS)
	$(CC) $(COPTS) $(LDFLAGS) $(SERVER_OBJS) -o $@ $(SERVER_LIBS)

.c.o:
	$(CC) $(COPTS) -c $<

depend:
	makedepend -Y -- $(COPTS) -- *.[ch] 2>/dev/null

install:
	mkdir -p $(DESTDIR)$(bindir)
	$(INSTALL) conman $(DESTDIR)$(bindir)/
	$(INSTALL) conmen $(DESTDIR)$(bindir)/
	mkdir -p $(DESTDIR)$(sbindir)
	$(INSTALL) conmand $(DESTDIR)$(sbindir)/
	mkdir -p $(DESTDIR)/etc
	$(INSTALL) -m 644 conman.conf $(DESTDIR)/etc
	for f in `cd lib && find * -name "CVS" -prune -o -type f -print`; do \
	  mkdir -p `dirname $(DESTDIR)$(libdir)/$(PACKAGE)/$$f`; \
	  $(INSTALL) -m 755 lib/$$f $(DESTDIR)$(libdir)/$(PACKAGE)/$$f; \
	done

clean:
	-rm -f *.o *.a *~ \#* core *.core

distclean: clean
	-rm -f config.cache config.log config.status stamp-h Makefile.bak
	-rm -f $(AC_OUTPUT)
	-rm -f $(PROGS)

Makefile: Makefile.in config.status
	./config.status

config.status: VERSION
	./config.status --recheck

# DO NOT DELETE THIS LINE -- make depend depends on it.
