# $Id: conman.spec.in,v 1.10 2001/12/12 20:08:46 dun Exp $

Name:    @PACKAGE@
Version: @VERSION@
Release: 1

Summary: ConMan - Remote Console Management
Group:   Applications/Communications
License: LLNL/Internal-Use-Only
#URL:     http://www.llnl.gov/linux/

BuildRoot: %{_tmppath}/%{name}-%{version}

Source0: %{name}-%{version}.tgz

%description
ConMan is currently available for LLNL internal use only.
An unrestricted GPL release of ConMan is pending Review & Release.

%prep
%setup

%build
test -n "$RPM_ENABLE_DEBUG" && DEBUG="--enable-debug"
CFLAGS="$RPM_OPT_FLAGS" LDFLAGS="-s" ./configure --prefix=/usr $DEBUG
make

%install
rm -rf "$RPM_BUILD_ROOT"
mkdir -p "$RPM_BUILD_ROOT"
DESTDIR="$RPM_BUILD_ROOT" make install

%clean
rm -rf "$RPM_BUILD_ROOT"

%pre
if [ -x /etc/rc.d/init.d/conman ]; then
  if /etc/rc.d/init.d/conman status | grep running >/dev/null 2>&1; then
    /etc/rc.d/init.d/conman stop
  fi
fi

%post
if [ -x /etc/rc.d/init.d/conman ]; then
  [ -x /sbin/chkconfig ] && /sbin/chkconfig --del conman
  [ -x /sbin/chkconfig ] && /sbin/chkconfig --add conman
  if ! /etc/rc.d/init.d/conman status | grep running >/dev/null 2>&1; then
    /etc/rc.d/init.d/conman start
  fi
fi

%preun
if [ "$1" = 0 ]; then                   # last version of pkg being erased
  if [ -x /etc/rc.d/init.d/conman ]; then
    [ -x /sbin/chkconfig ] && /sbin/chkconfig --del conman
    if /etc/rc.d/init.d/conman status | grep running >/dev/null 2>&1; then
      /etc/rc.d/init.d/conman stop
    fi
  fi
fi

%files
%defattr(-,root,root,0755)
%config(noreplace) /etc/conman.conf
%config(noreplace) /etc/logrotate.d/conman
%config(roreplace) /etc/rc.d/init.d/conman
/usr/bin/conman
/usr/bin/conmen
/usr/sbin/conmand
%dir /usr/lib/conman
/usr/lib/conman/alpha.exp
/usr/lib/conman/conman.exp
%dir /usr/lib/conman/examples
/usr/lib/conman/examples/boot_alpha.exp
/usr/lib/conman/examples/mac.exp
/usr/lib/conman/examples/rmc.exp
/usr/lib/conman/examples/srm.exp
/usr/lib/conman/examples/wtf.exp
