# $Id: conman.spec.in,v 1.5 2001/08/30 18:12:45 dun Exp $

%define name    @PACKAGE@
%define version @VERSION@
%define release 1

Name: %name
Version: %version
Release: %release
Summary: ConMan - Remote Serial Console Management
#URL: FOO
Group: Applications/Communications
Copyright: LLNL/Internal-Use-Only
BuildRoot: %{_tmppath}/%{name}-%{version}

Source0: %{name}-%{version}.tgz

%description
ConMan is currently available for LLNL internal use only.
An unrestricted GPL release of ConMan is pending Review & Release.

%prep
%setup

%build
CFLAGS="$RPM_OPT_FLAGS" LDFLAGS="-s" ./configure --prefix=/usr
make

%install
rm -rf "$RPM_BUILD_ROOT"
mkdir -p "$RPM_BUILD_ROOT"
DESTDIR="$RPM_BUILD_ROOT" make install

%clean
rm -rf "$RPM_BUILD_ROOT"

%pre
if [ -x /etc/rc.d/init.d/conman ]; then
  if /etc/rc.d/init.d/conman status | grep running >/dev/null 2>&1; then
    /etc/rc.d/init.d/conman stop
  fi
fi

%post
if [ -x /etc/rc.d/init.d/conman ]; then
  [ -x /sbin/chkconfig ] && /sbin/chkconfig --del conman
  [ -x /sbin/chkconfig ] && /sbin/chkconfig --add conman
  if /etc/rc.d/init.d/conman status | grep stopped >/dev/null 2>&1; then
    /etc/rc.d/init.d/conman start
  fi
fi

%preun
if [ "$1" = 0 ]; then                   # last version of pkg being erased
  if [ -x /etc/rc.d/init.d/conman ]; then
    [ -x /sbin/chkconfig ] && /sbin/chkconfig --del conman
    if /etc/rc.d/init.d/conman status | grep running >/dev/null 2>&1; then
      /etc/rc.d/init.d/conman stop
    fi
  fi
fi

%files
%defattr(-,root,root,0755)
%config(noreplace) /etc/conman.conf
/etc/rc.d/init.d/conman
/usr/bin/conman
/usr/bin/conmen
/usr/sbin/conmand
%dir /usr/lib/conman
/usr/lib/conman/alpha.exp
/usr/lib/conman/conman.exp
%dir /usr/lib/conman/examples
/usr/lib/conman/examples/boot_alpha.exp
/usr/lib/conman/examples/mac.exp
/usr/lib/conman/examples/rmc.exp
/usr/lib/conman/examples/srm.exp
/usr/lib/conman/examples/wtf.exp
